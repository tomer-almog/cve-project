from modules.client import RequestClient
from json import loads
from os import getenv

PROTOCOL = getenv('PROTOCOL')
BASE_URL = getenv('BASE_URL')


class GetCVES:

    # This function executes a request to CIRCL to get the CVEs of a particular product
    @classmethod
    def request(cls, vendor, product):
        url = cls.prepare_url(vendor, product)
        response = loads(RequestClient.get(url, headers={}).text)
        if 'error' in response:
            return response
        try:
            cves = []
            for result in response['results']:
                cves.append(result['id'])
            return cves
        except AttributeError:
            return {'error': {'message': 'Result not received in expected format; Either you misspelled the product/vendor, or an error occurred on CIRCL\'s side.'}}

    @staticmethod
    def prepare_url(vendor, product):
        return f'{PROTOCOL}://{BASE_URL}/{vendor}/{product}'
