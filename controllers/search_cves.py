from modules.client import RequestClient
from json import loads
from os import getenv

PROTOCOL = getenv('PROTOCOL')
BASE_URL = getenv('BASE_URL')


class SearchCVES:

    # This function executes a request to CIRCL to get the CVEs related to a keyword
    @classmethod
    def request(cls, keyword):
        url = cls.prepare_url(keyword)
        response = loads(RequestClient.get(url, headers={}).text)
        if 'error' in response:
            return response
        try:
            cves = []
            for result in response['data']:
                cves.append(result['id'])
            return cves
        except AttributeError:
            return {'error': 'Result not received in expected format; It seems like an error occurred on CIRCL\'s side.'}

    @staticmethod
    def prepare_url(keyword):
        return f'{PROTOCOL}://{BASE_URL}/{keyword}'
